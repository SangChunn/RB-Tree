.PHONY: test test-fast clean

CPPFLAGS += -DSENTINEL -I ../src -I ../lib
CFLAGS   += -Wall -g
# (ì„ íƒ) Valgrindì—ì„œ ìŠ¤íƒ ì¶”ì  ë” ë³´ê¸° ì¢‹ê²Œ
# CFLAGS   += -O0 -fno-omit-frame-pointer

SRCS   := test_unity_rbtree.c ../src/rbtree.c ../lib/unity.c
OBJS   := $(SRCS:.c=.o)
TARGET := test_unity_rbtree

VALGRIND ?= valgrind --leak-check=full --show-leak-kinds=all

$(TARGET): $(OBJS)
	$(CC) $(CFLAGS) $(CPPFLAGS) $(OBJS) -o $(TARGET)

# ë¹ ë¥¸ í…ŒìŠ¤íŠ¸(Valgrind X)
test-fast: $(TARGET)
	@echo "ğŸš€ Running Unity tests..."
	./$(TARGET)

# ê¸°ë³¸: í…ŒìŠ¤íŠ¸ + ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ê²€ì‚¬
test: $(TARGET)
	@echo "ğŸš€ Running Unity tests..."
	./$(TARGET)
	@echo ""
	@echo "ğŸ” Running Valgrind memory leak check..."
	$(VALGRIND) ./$(TARGET)

clean:
	$(RM) $(TARGET) $(OBJS)